---
layout: post
title:  "树莓派3安装bluez5.37"
date:   2017-04-01
excerpt: "Raspberry-pi  Buluez Bluetooth BLE D-bus"
tag:
- raspberry pi 环境搭建 
- 下载安装bluez
- 测试bluez
- DBUS 监测

---
# 树莓派3安装bluez 5.37
最近需要使用Bluez和D-bus做一个项目，以前一直没有研究过bluez和d-bus，这次正好研究和记录下。

### 环境搭建 
由于只是deom性质的开发，目前没有实际的硬件，先使用Raspberry pi3作为开发硬件。

### 关于树莓派固件

为了驱动最新的蓝牙芯片最好使用官方最新的固件  
官方固件下载地址:`http://downloads.raspberrypi.org/raspbian/images/`  

### 安装BlueZ蓝牙协议栈

在默认的官方固件中是不包含蓝牙协议栈的，所以我们需要安装Linux官方提供的Bluetooth协议栈，但是在官方的ppa（依赖安装源）提供的版本比较老，所以若条件允许我们还是需要安装一个版本比较高的BlueZ。

首先更新系统，并安装必备的软件库  
```
sudo apt-get update  
sudo apt-get upgrade 
sudo apt-get install libdbus-1-dev libdbus-glib-1-dev libglib2.0-dev libical-dev libreadline-dev libudev-dev libusb-dev make wget 
```

然后下载Bluez最新源码：  
```
wget https://www.kernel.org/pub/linux/bluetooth/bluez-5.37.tar.xz
tar xvf bluez-5.37.tar.xz
cd bluez-5.37   
```

然后进行编译，编译比较耗费时间：    
```
./configure --disable-systemd
make   
```
编译完成后，进行安装，此时需要安装至系统目录下，所以需要sudo命令：   
`sudo make install`   
此时就完成了Bluez协议栈的安装。


### 一些错误分析
error :GLib>=2.28 is required:   
这个错误需要安装如下依赖：   
`sudo apt-get install glib2.0`   


error ：D-Bus >= 1.6 is required的错误，这时我们需要更新D-Bus的版本：   
```
wget http://dbus.freedesktop.org/releases/dbus/dbus-1.10.6.tar.gz   
tar zxvf dbus-1.10.6.tar.gz    
cd dbus-1.10.6    
#安装到默认目录下   
./configure    
make    
sudo make install    
```



